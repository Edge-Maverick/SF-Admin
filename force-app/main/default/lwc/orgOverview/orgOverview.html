<template>
    <lightning-card title="Organization Overview" icon-name="standard:topic">
        <div slot="actions">
            <template if:true={orgDetails}>
                <div class="slds-grid slds-grid_vertical-align-center trust-badge-container" onclick={handleOpenDrawer}>
                    <span class="slds-text-heading_small slds-var-m-right_small slds-text-color_default"><strong>{orgDetails.InstanceName}</strong></span>
                    <span class="trust-badge slds-var-m-right_x-small">OK</span>
                    <lightning-icon icon-name="utility:info" size="xx-small" class="slds-text-color_weak"></lightning-icon>
                </div>
            </template>
        </div>
        
        <div class="slds-var-p-horizontal_medium">
            <!-- Collapsible Details Section -->
            <div class={contentClass}>
                <template if:true={orgDetails}>
                    <lightning-layout multiple-rows>
                        <lightning-layout-item size="6" padding="around-small">
                            <div class="slds-media slds-media_center">
                                <div class="slds-media__figure">
                                    <lightning-icon icon-name="standard:account" size="small" variant="inverse" class="icon-container"></lightning-icon>
                                </div>
                                <div class="slds-media__body">
                                    <p class="slds-text-title_caps slds-text-color_weak">Name</p>
                                    <p class="slds-text-heading_small">{orgDetails.Name}</p>
                                </div>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="6" padding="around-small">
                            <div class="slds-media slds-media_center">
                                <div class="slds-media__figure">
                                    <lightning-icon icon-name="standard:identifier" size="small" variant="inverse" class="icon-container"></lightning-icon>
                                </div>
                                <div class="slds-media__body">
                                    <p class="slds-text-title_caps slds-text-color_weak">Org Id</p>
                                    <p class="slds-text-heading_small">{orgDetails.Id}</p>
                                </div>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="6" padding="around-small">
                            <div class="slds-media slds-media_center">
                                <div class="slds-media__figure">
                                    <lightning-icon icon-name="standard:server" size="small" variant="inverse" class="icon-container"></lightning-icon>
                                </div>
                                <div class="slds-media__body">
                                    <p class="slds-text-title_caps slds-text-color_weak">Instance</p>
                                    <p class="slds-text-heading_small">{orgDetails.InstanceName}</p>
                                </div>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="6" padding="around-small">
                            <div class="slds-media slds-media_center">
                                <div class="slds-media__figure">
                                    <lightning-icon icon-name="standard:code_playground" size="small" variant="inverse" class="icon-container"></lightning-icon>
                                </div>
                                <div class="slds-media__body">
                                    <p class="slds-text-title_caps slds-text-color_weak">Sandbox</p>
                                    <p class="slds-text-heading_small">
                                        <lightning-badge label={sandboxLabel} class={sandboxBadgeClass}></lightning-badge>
                                    </p>
                                </div>
                            </div>
                        </lightning-layout-item>
                    </lightning-layout>
                </template>
                
                <template if:true={error}>
                     <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert">
                        <span class="slds-assistive-text">error</span>
                        <h2>Error retrieving data</h2>
                    </div>
                </template>

                <template if:true={releaseInfo}>
                    <div class="maintenance-banner slds-var-m-top_medium">
                        <div class="slds-grid slds-grid_vertical-align-center slds-var-p-around_small">
                            <lightning-icon icon-name="utility:warning" size="small" variant="warning" class="slds-var-m-right_small"></lightning-icon>
                            <div class="slds-col slds-grow">
                                <p class="slds-text-body_regular">
                                    <strong>Upcoming Maintenance:</strong> {releaseInfo.name} on <lightning-formatted-date-time value={releaseInfo.releaseDate}></lightning-formatted-date-time>
                                </p>
                            </div>
                            <lightning-button-icon icon-name="utility:close" variant="bare" size="small" onclick={handleDismissRelease} alternative-text="Dismiss"></lightning-button-icon>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Toggle Button -->
            <div class="slds-align_absolute-center slds-var-m-vertical_small">
                <lightning-button-icon 
                    icon-name={iconName} 
                    alternative-text={buttonLabel} 
                    title={buttonLabel}
                    variant="border-filled" 
                    onclick={toggleContent}
                    aria-expanded={isContentVisible}>
                </lightning-button-icon>
            </div>

            <!-- Main Content (Always Visible) -->
            <div class="slds-box slds-theme_default main-summary-box">
                <h2 class="slds-text-heading_small slds-var-m-bottom_small slds-border_bottom slds-var-p-bottom_x-small">
                    <lightning-icon icon-name="utility:chart" size="x-small" class="slds-var-m-right_x-small"></lightning-icon>
                    Quick Stats
                </h2>
                <lightning-layout multiple-rows>
                    <lightning-layout-item size="12" small-device-size="6" medium-device-size="3" padding="around-small">
                        <div class="stat-item">
                            <p class="stat-label">Limits Usage</p>
                            <p class="stat-value">78%</p>
                        </div>
                    </lightning-layout-item>
                    <lightning-layout-item size="12" small-device-size="6" medium-device-size="3" padding="around-small">
                        <div class="stat-item">
                            <p class="stat-label">Active Users</p>
                            <p class="stat-value">1,240</p>
                        </div>
                    </lightning-layout-item>
                    <lightning-layout-item size="12" small-device-size="6" medium-device-size="3" padding="around-small">
                        <div class="stat-item">
                            <p class="stat-label">Readiness</p>
                            <p class="stat-value">Good</p>
                        </div>
                    </lightning-layout-item>
                </lightning-layout>
            </div>

        <!-- Sticky Board Component -->
            <div class="slds-var-m-top_medium">
                                    <c-admin-sticky-board></c-admin-sticky-board>
             </div>

            <!--  FOOTER FOR QUICK LAUNCH -->
            <div class="slds-box slds-theme_default main-summary-box ">
                <h2 class="slds-text-heading_small slds-var-m-bottom_small slds-border_bottom slds-var-p-bottom_x-small">
                    <lightning-icon icon-name="utility:link" size="x-small" class="slds-var-m-right_x-small"></lightning-icon>
                    Quick Launch
                </h2>
                <lightning-layout multiple-rows vertical-align="center" horizontal-align="center" pull-to-boundary="large">
                    <template if:true={quickLaunchItems}>
                        <template for:each={quickLaunchItems} for:item="item">
                            <lightning-layout-item key={item.Name} size="3" small-device-size="6" medium-device-size="3" large-device-size="2" padding="around-small">
                                <div class="slds-visual-picker slds-visual-picker_small">
                                    
                                    <label for="visual-picker-94">
                                        <span class="slds-visual-picker__figure slds-visual-picker__icon slds-align_absolute-center">
                                        <span class="slds-is-selected">
                                            <span class="slds-icon_container">
                                            <svg class="slds-icon slds-icon_large slds-icon-action-check" aria-hidden="true">
                                                <use xlink:href="/assets/icons/action-sprite/svg/symbols.svg#check"></use>
                                            </svg>
                                            </span>
                                        </span>
                                        <span class="slds-is-not-selected">
                                            <span class="slds-icon_container">
                                            <!--svg class="slds-icon slds-icon-standard-account slds-icon_large" aria-hidden="true">
                                                <use xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#account"></use>
                                            </svg-->
                                            <lightning-icon icon-name={item.icon} size="large"></lightning-icon>
                                            </span>
                                        </span>
                                        </span>
                                        <span class="slds-visual-picker__body">
                                        <span class="slds-text-title">{item.label}</span>
                                        </span>
                                    </label>
                                </div>
                            
                            </lightning-layout-item>
                        </template>
                    </template>
                    
                </lightning-layout>
            </div>
        </div>

        <!-- Drawer Component -->
        <template if:true={isDrawerOpen}>
            <div class="drawer-backdrop" onclick={handleCloseDrawer}></div>
            <div class="drawer-panel">
                <div class="drawer-header slds-grid slds-grid_align-spread slds-var-p-around_medium slds-border_bottom">
                    <h2 class="slds-text-heading_medium">System Status: {orgDetails.InstanceName}</h2>
                    <lightning-button-icon icon-name="utility:close" variant="bare" size="large" onclick={handleCloseDrawer}></lightning-button-icon>
                </div>
                <div class="drawer-content slds-var-p-around_medium">
                    <!-- Info Grid -->
                    <div class="info-grid slds-var-m-bottom_medium">
                        <div class="info-item">
                            <p class="info-label">Version</p>
                            <p class="info-value">{releaseVersion}</p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">API Version</p>
                            <p class="info-value">{apiLevel}</p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">Next Update</p>
                            <p class="info-value">{nextUpdateName}</p>
                        </div>
                        <div class="info-item">
                            <p class="info-label">Date</p>
                            <p class="info-value">
                                <lightning-formatted-date-time value={nextUpdateDate} year="numeric" month="short" day="2-digit"></lightning-formatted-date-time>
                            </p>
                        </div>
                    </div>

                    <!-- Incident Status -->
                    <h3 class="slds-text-heading_small slds-var-m-bottom_small">Incident Status</h3>
                    
                    <template if:false={hasActiveIncidents}>
                        <div class="status-card success slds-var-p-around_large slds-text-align_center slds-var-m-bottom_medium">
                            <lightning-icon icon-name="utility:check" variant="success" size="large" class="slds-var-m-bottom_small"></lightning-icon>
                            <h2 class="slds-text-heading_medium">All Systems Operational</h2>
                            <p class="slds-var-m-top_x-small">No active incidents reported for your instance.</p>
                            <p class="slds-text-body_small slds-var-m-top_small" style="opacity: 0.7;">Last checked: Just now</p>
                        </div>
                    </template>

                    <template if:true={hasActiveIncidents}>
                        <div class="status-card error slds-var-p-around_large slds-text-align_center slds-var-m-bottom_medium">
                            <lightning-icon icon-name="utility:warning" variant="error" size="large" class="slds-var-m-bottom_small"></lightning-icon>
                            <h2 class="slds-text-heading_medium">Active Incidents Reported</h2>
                            <template for:each={activeIncidents} for:item="incident">
                                <div key={incident.id} class="slds-box slds-theme_error slds-var-m-top_small slds-text-align_left">
                                    <p>{incident.message}</p>
                                </div>
                            </template>
                        </div>
                    </template>

                    <!-- Previous Incidents -->
                    <lightning-accordion allow-multiple-sections-open>
                        <lightning-accordion-section name="previous" label="Previous Incidents">
                            <template if:true={pastIncidents}>
                                <div class="timeline">
                                    <template for:each={pastIncidents} for:item="incident">
                                        <div key={incident.id} class="timeline-item">
                                            <p class="timeline-date">
                                                <lightning-formatted-date-time value={incident.createdAt} year="numeric" month="short" day="2-digit" hour="2-digit" minute="2-digit"></lightning-formatted-date-time>
                                            </p>
                                            <p class="timeline-message">{incident.message}</p>
                                        </div>
                                    </template>
                                </div>
                            </template>
                            <template if:false={pastIncidents}>
                                <p class="slds-text-color_weak slds-text-align_center slds-var-p-vertical_medium">No recent incidents found.</p>
                            </template>
                        </lightning-accordion-section>
                        <lightning-accordion-section name="health" label="Service Health">
                            <p>Service health metrics would go here.</p>
                        </lightning-accordion-section>
                    </lightning-accordion>
                </div>
            </div>
        </template>
    </lightning-card>
</template>