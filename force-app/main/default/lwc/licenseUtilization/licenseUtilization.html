<template>
    <div class="main-container">
        <!-- Header Section -->
        <div class="header-section slds-var-m-bottom_medium">
            <div class="slds-grid slds-grid_vertical-align-center slds-grid_align-spread">
                <div class="slds-media slds-media_center">
                    <div class="slds-media__figure">
                        <lightning-icon icon-name="standard:resource_capacity" size="medium" alternative-text="License Utilization" title="License Utilization"></lightning-icon>
                    </div>
                    <div class="slds-media__body">
                        <h1 class="slds-page-header__title" title="License Utilization">License Utilization</h1>
                        <p class="slds-text-body_small">Get insight into your orgs License Consumptions and find areas to improve</p>
                    </div>
                </div>
                <div class="actions slds-grid slds-grid_vertical-align-center">
                    <!-- Filter Toggle Button -->
                    <!--lightning-button-icon 
                        icon-name="utility:filterList" 
                        variant={filterButtonVariant}
                        alternative-text="Toggle Filters" 
                        title="Toggle Filters"
                        onclick={toggleFilterDrawer}
                        class="slds-var-m-right_x-small">
                    </lightning-button-icon-->
                    <lightning-button-icon icon-name="utility:table" title="Hide & Show table data" onclick={handleShowHideTable} variant={showButtonVarient} class="slds-var-m-right_x-small"></lightning-button-icon>
                    <lightning-button-icon icon-name="utility:refresh" onclick={handleRefresh} variant="border-filled"></lightning-button-icon>
                </div>
            </div>
        </div>

        <!--- BODY -->
    <lightning-layout vertical-align="spread" multiple-rows>

        <lightning-layout-item size="12">
            <div class="custom-card">
            <lightning-layout horizontal-align="space">
                <template lwc:if={globalKpis}>
                    <template for:each={globalKpis} for:item="kpi">
                        <lightning-layout-item key={kpi.label} size="3">
                            <c-loki-kpi-progress title={kpi.label} used-value={kpi.activeLicenses} total-value={kpi.totalLicenses} display-mode="fill" auto-format inverse-format>
                            </c-loki-kpi-progress>
                        </lightning-layout-item>
                    </template>
                </template>
            </lightning-layout>
            </div>
        </lightning-layout-item>
        
        <lightning-layout-item size="12" >
            
            <div class="custom-card">
                <div style="width:100%;" class="slds-var-m-bottom_x-small">
                    <strong class="slds-text-heading_small">USER LICENSE</strong>
                    <lightning-helptext content="Shows the utilization of licenses across the org. ( source: UserLicense|User )"></lightning-helptext>
                </div>
                <div class="slds-var-m-bottom_medium">
                    <template lwc:if={userLicenseData}>
                        <c-license-utilization-helper 
                        wrapper-data={userLicenseData}
                        show-table={showTable}>
                        </c-license-utilization-helper>
                    </template>
                </div>
            </div>
        </lightning-layout-item>

        <lightning-layout-item size="12" >
            
            <div class="custom-card">
            <div style="width:100%;" class="slds-var-m-bottom_x-small">
                <strong class="slds-text-heading_small">PERMISSION SET LICENSE</strong>
                <lightning-helptext content="Shows the utilization of licenses across the org. ( source: UserLicense|User )"></lightning-helptext>
            </div>
            <div class="slds-var-m-bottom_medium">
                <template lwc:if={psLicenseData}>
                    <c-license-utilization-helper 
                    wrapper-data={psLicenseData}
                    show-table={showTable}>
                    </c-license-utilization-helper>
                </template>
            </div>
            </div>
        </lightning-layout-item>

        <lightning-layout-item size="12" >
            
            <div class="custom-card">
            <div style="width:100%;" class="slds-var-m-bottom_x-small">
                <strong class="slds-text-heading_small">FEATURE LICENSE</strong>
                <lightning-helptext content="Shows the utilization of licenses across the org. ( source: UserLicense|User )"></lightning-helptext>
                <template lwc:if={featureLicenseData}><template lwc:if={featureLicenseData.strMetricsDate}><span class="slds-text-color_weak slds-float_right">metrics date: {featureLicenseData.strMetricsDate}</span></template></template>
            </div>
            <div class="slds-var-m-bottom_medium">
                <template lwc:if={featureLicenseData}>
                    <c-license-utilization-helper 
                    wrapper-data={featureLicenseData}
                    show-table={showTable}>
                    </c-license-utilization-helper>
                </template>
            </div>
            </div>
        </lightning-layout-item>

    </lightning-layout>
    </div>
</template>